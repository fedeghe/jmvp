(function(W){"use strict";var jmvp={};jmvp.utils={};jmvp.utils.ucfirst=function(a){return a.slice(0, 1).toUpperCase()+a.slice(1);};jmvp.extends=function(Child, Parent){function T(){}T.prototype=Parent.prototype;Child.prototype=new T();Child.prototype.constructor=Child;Child.superClass=Parent.prototype;Child.baseConstructor=Parent;Child.super=function(inst){var args=[].slice.call(arguments, 1);Parent.apply(inst, args);}};function Model(d){this._data=d;this._auto();}Model.prototype._get=function(name){return this._data[name]|| null;};Model.prototype._has=function(name){return name && name in this._data;};Model.prototype._auto=function(){var data=this._data, self=this;for(var i in data)if(data.hasOwnProperty(i)&& typeof i==='string'){self._getter(i);self._setter(i);}};Model.prototype._setter=function(name){notValidModel(name, 'setter');var self=this;self['set'+jmvp.utils.ucfirst(name)]=function(value, done){var cb=done ? done.bind(self):function(){};self._data[name]=value;cb && cb(name, value);};};Model.prototype._getter=function(name){var self=this;notValidModel(name, 'getter');self['get'+jmvp.utils.ucfirst(name)]=function(){return self._data[name];}};Model.prototype.getData=function(){return this._data;};Model.prototype.defineMethod=function(name, func){notValidModel(name, 'method');this.constructor.prototype[name]=func;};function notValidModel(n, type){if(n.match(/_setter|_getter|_data|_auto|defineMethod/)){throw 'Forbidden '+type+' `'+n+'`';}}function View(tpl){var t=document.createElement('div'), self=this;this.tpl=tpl.replace(/\r?\n|\r|\t|\s\s/gm, '');;t.innerHTML=this.tpl;this.node=t.childNodes[0];this.childs=[];this._init();};View.prototype._init=function(){this._refs();};View.prototype._refs=function(){(function dig(node, acc){var i=0, childs=node.childNodes, l=childs.length, tmp;for(null;i < l;i++){tmp={node:childs[i], childs:[]};acc.push(tmp);dig(childs[i], tmp.childs);}})(this.node, this.childs);};View.prototype.setModel=function(model){(function dig(node){var i=0, childs=node.childNodes, l=childs.length, tmp, vname;if(node.nodeName==='#text'){while(tmp=node.textContent.match(/{([^}]*)}/)){vname=tmp && tmp[1];node.textContent=node.textContent.replace(tmp[0], vname && model._has(vname)? model._data[vname]:'');}}for(null;i < l;i++){dig(childs[i]);}})(this.node);};View.prototype.setHandler=function(nodePath, ev, handler){try{var n=this.getNode.apply(this, nodePath);}catch(e){console.log(e)}return n && n.addEventListener(ev, handler);};View.prototype.defineMethod=function(name, func){this[name]=func.bind(this);};View.prototype.getNode=function(){var a=[].slice.call(arguments), ret=this, childs=this.childs, i=0, l=a.length;for(null;i < l;i++){ret=childs[a[i]];if(!ret)throw a+' not found, handler not settable';childs=ret.childs;}return ret && ret.node;};function Presenter(model, view){this.model=model;this.view=view;};Presenter.prototype.init=function(){};Presenter.prototype.setModel=function(model){this.model=model;};Presenter.prototype.setView=function(view){this.view=view;};Presenter.prototype.setHandler=function(){this.view.setHandler.apply(this.view, arguments);};Presenter.prototype.getNode=function(){return this.view.node;};Presenter.prototype.defineMethod=function(name, func){this[name]=func.bind(this);};Presenter.prototype.render=function(trg){this.init();trg.appendChild(this.view.node);};var NS={};NS.Model=function(data){function model(d){this._data=d || data;};jmvp.extends(model, Model);return function(d){var ret=new model(d || data);model.super(ret, d || data);return ret;};};NS.View=function(tpl){function view(t){this.tpl=t || tpl;};jmvp.extends(view, View);return function _view(t){var ret=new view(t || tpl);view.super(ret, t || tpl);return ret;};};NS.Presenter=function(modelObj, viewObj){function presenter(m, v){this.model=m;this.view=v;};jmvp.extends(presenter, Presenter);return function _presenter(m, v){m=m || modelObj;v=v || viewObj;var ret=new presenter(m, v);presenter.super(ret, m, v);return ret;};};W.JMVP=NS;})(window);